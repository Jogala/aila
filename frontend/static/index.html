<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Document Change Analyzer</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <!-- Disclaimer Popup -->
    <div id="disclaimerModal" class="disclaimer-modal">
        <div class="disclaimer-content">
            <h1>‚ö†Ô∏è IMPORTANT DISCLAIMER - PROTOTYPE DEMONSTRATION ONLY</h1>
            
            <h2>Before proceeding, please read and accept the following terms:</h2>
            
            <div class="disclaimer-section">
                <h3>üö® NO LEGAL ADVICE</h3>
                <p>This tool is a <strong>technology demonstration only</strong> and does not provide legal advice. The analysis, summaries, or interpretations generated are for informational and testing purposes only. <strong>Do not rely on this tool for any legal decisions.</strong></p>
            </div>
            
            <div class="disclaimer-section">
                <h3>üß™ PROTOTYPE STATUS</h3>
                <ul>
                    <li>This is an <strong>experimental prototype</strong> with limited accuracy</li>
                    <li>Results may contain errors, omissions, or misinterpretations</li>
                    <li>The tool is under development and not suitable for production use</li>
                    <li>Features and functionality may change or break without notice</li>
                </ul>
            </div>
            
            <div class="disclaimer-section">
                <h3>üîí DATA & PRIVACY</h3>
                <ul>
                    <li><strong>Do not upload confidential, privileged, or sensitive legal documents</strong></li>
                    <li>Uploaded content may be processed by third-party services</li>
                    <li>We cannot guarantee the security or confidentiality of uploaded materials</li>
                    <li>Use only publicly available or non-sensitive test documents</li>
                </ul>
            </div>
            
            <div class="disclaimer-section">
                <h3>‚öñÔ∏è LEGAL LIMITATIONS</h3>
                <ul>
                    <li><strong>Always consult qualified legal professionals</strong> for actual legal matters</li>
                    <li>This tool cannot replace human legal expertise or judgment</li>
                    <li>Different jurisdictions have varying laws - this tool cannot account for all variations</li>
                    <li>Document analysis may miss critical legal nuances or context</li>
                </ul>
            </div>
            
            <div class="disclaimer-section">
                <h3>üõ°Ô∏è LIMITATION OF LIABILITY</h3>
                <p>By using this prototype, you acknowledge that:</p>
                <ul>
                    <li>The developers assume <strong>no liability</strong> for any decisions made based on this tool's output</li>
                    <li>You use this service entirely <strong>at your own risk</strong></li>
                    <li>This tool is provided "as-is" without warranties of any kind</li>
                    <li>We are not responsible for any damages, losses, or consequences from use</li>
                </ul>
            </div>
            
            <div class="disclaimer-section">
                <h3>‚úÖ ACCEPTANCE</h3>
                <p>By clicking "I Understand and Accept" below, you confirm that you:</p>
                <ul>
                    <li>Understand this is a prototype for demonstration purposes only</li>
                    <li>Will not use this tool for actual legal decision-making</li>
                    <li>Will not upload confidential or sensitive documents</li>
                    <li>Agree to the limitations and disclaimers above</li>
                    <li>Will seek professional legal counsel for any real legal matters</li>
                </ul>
            </div>
            
            <div class="disclaimer-footer">
                <strong>Remember: When in doubt, consult a real lawyer!</strong>
            </div>
            
            <button id="acceptDisclaimer" class="accept-btn">I Understand and Accept</button>
        </div>
    </div>

    <!-- Main Application (initially hidden) -->
    <div id="mainApp" class="main-app" style="display: none;">
        <!-- Load configuration first -->
        <script src="/static/config.js"></script>

        <div class="container">
        <div class="header">
            <h1>Aila - Your AI Legal Assistant (Demo)</h1>
            <p>AI-powered legal document comparison and analysis</p>
            <div class="config-info" id="configInfo">
                API Endpoint: <span id="apiEndpoint">Loading...</span>
                <div class="server-status">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="serverStatus">Checking server...</span>
                </div>
            </div>
        </div>

        <!-- Server Status Guide -->
        <div class="server-guide" id="serverGuide" style="display: none;">
            <h3>üöÄ FastAPI Server Setup Required</h3>
            <p>The analysis server is not running. Please start the FastAPI server to use the document analyzer.</p>

            <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">Quick Start</h4>
            <div class="command-block">
                # MAKE SURE YOU ARE IN THE PROJECT ROOT
            </div>

            <div class="command-block">
                <button class="copy-btn" onclick="copyToClipboard('python -m venv .venv && . .venv/bin/activate && poetry config virtualenvs.create false && poetry install --with api')">Copy</button>
                # Create and activate venv (once), then install
                python -m venv .venv
                source .venv/bin/activate
                poetry config virtualenvs.create false
                poetry install --with api
            </div>

            <div class="command-block">
                <button class="copy-btn"
                    onclick="copyToClipboard('uvicorn aila.api.main:app --reload --port 8000')">Copy</button>
                # Start the server
                uvicorn aila.api.main:app --reload --port 8000
            </div>

            <p><strong>Alternative:</strong> If you have the server running on a different port, update your
                <code>.env</code> file and regenerate the config:
            </p>
            <div class="command-block">
                <button class="copy-btn" onclick="copyToClipboard('python frontend/generate_config.py')">Copy</button>
                # Update frontend config
                python frontend/generate_config.py
            </div>

            <button class="btn" onclick="checkServerStatus()" style="margin-top: 1rem; max-width: 200px;">
                üîÑ Check Again
            </button>
        </div>

        <div class="sections">
            <!-- Server API Keys Status Panel (shown when server has keys) -->
            <div class="section" id="serverApiKeysPanel" style="display: none;">
                <h2 class="section-title">‚úÖ Server API Keys Configured</h2>
                <div class="api-keys-info">
                    <p><strong>üîê Using Server API Keys</strong></p>
                    <p>This server has API keys configured. Analysis will use the server's keys automatically.</p>
                    <div id="serverKeyDetails"></div>
                </div>
            </div>
            
            <!-- User API Keys Panel (shown when server doesn't have keys) -->
            <div class="section" id="userApiKeysPanel" style="display: none;">
                <h2 class="section-title">üîë API Keys Required</h2>
                <div class="api-keys-info">
                    <p><strong>‚ö†Ô∏è Server API Keys Not Configured</strong></p>
                    <p>This server doesn't have API keys configured. Please provide your own API keys to use the analysis features.</p>
                    <p><small><strong>Privacy:</strong> Your API keys are sent securely with each request and are never stored on the server.</small></p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="userApiKeyProvider">API Key Provider</label>
                        <select id="userApiKeyProvider" name="userApiKeyProvider" required>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                        </select>
                        <small>Choose the provider for your API key</small>
                    </div>
                    <div class="form-group">
                        <label for="userApiKey">API Key</label>
                        <input type="password" id="userApiKey" name="userApiKey" placeholder="sk-..." required>
                    </div>
                </div>
                
                <div class="api-keys-note">
                    <small><strong>Note:</strong> Make sure your API key provider matches the LLM provider selected in the configuration above.</small>
                </div>
            </div>
            
            <!-- LLM Settings Panel -->
            <div class="section llm-settings">
                <h2 class="section-title">‚öôÔ∏è LLM Configuration</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="llmProvider">LLM Provider</label>
                        <select id="llmProvider" name="provider" required>
                            <option value="anthropic">Anthropic</option>
                            <option value="openai">OpenAI</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="llmModel">Model</label>
                        <select id="llmModel" name="model" required>
                            <option value="" disabled selected>Loading models...</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="llmTemperature">Temperature</label>
                        <input type="number" id="llmTemperature" name="temperature" min="0" max="2" step="0.1"
                            value="0.1" required>
                    </div>
                    <div class="form-group">
                        <label for="llmPromptTemplate">Prompt Template</label>
                        <input type="text" id="llmPromptTemplate" name="prompt_template" value="prompt_2.txt"
                            required>
                    </div>
                </div>
            </div>
            
            <!-- File Upload Section -->
            <div class="section">
                <h2 class="section-title">üìÑ Upload Documents for Analysis</h2>
                <form id="fileAnalysisForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="document1">First Document</label>
                            <input type="file" id="document1" name="document1" accept=".txt,.pdf,.docx" required>
                        </div>
                        <div class="form-group">
                            <label for="document2">Second Document</label>
                            <input type="file" id="document2" name="document2" accept=".txt,.pdf,.docx" required>
                        </div>
                    </div>

                    <button type="submit" class="btn">Analyze Documents</button>
                    <div class="loading" id="fileLoading">üîÑ Analyzing documents...</div>
                    <div class="error" id="fileError"></div>
                </form>
            </div>

            <!-- Text Input Section -->
            <div class="section">
                <h2 class="section-title">üìù Analyze Text Directly</h2>
                <form id="textAnalysisForm">
                    <div class="form-group">
                        <label for="doc1Text">First Document Text</label>
                        <textarea id="doc1Text" name="doc1_text" placeholder="Paste"
                            required>This is the original contract. The payment terms are 30 days. Company A needs to pay 1‚Ç¨ to company B.</textarea>
                    </div>

                    <div class="form-group">
                        <label for="doc2Text">Second Document Text</label>
                        <textarea id="doc2Text" name="doc2_text" placeholder="Paste your second document text here..."
                            required>This is the updated contract. The payment terms are 1 day. Company A needs to pay 1000000‚Ç¨ to company B.</textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="doc1Name">First Document Name</label>
                            <input type="text" id="doc1Name" name="name_doc1" value="document1.txt" required>
                        </div>
                        <div class="form-group">
                            <label for="doc2Name">Second Document Name</label>
                            <input type="text" id="doc2Name" name="name_doc2" value="document2.txt" required>
                        </div>
                    </div>

                    <button type="submit" class="btn">Analyze Texts</button>
                    <div class="loading" id="textLoading">üîÑ Analyzing texts...</div>
                    <div class="error" id="textError"></div>
                </form>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results" id="results">
            <div class="results-header">
                <h2 class="results-title">üìä Analysis Results</h2>
                <button id="exportResultsBtn" class="export-btn" style="display: none;">
                    üì• Export JSON
                </button>
            </div>
            <div id="resultsContent"></div>
        </div>
    </div>
    </div>

    <script src="/static/scripts.js"></script>
    <script>
        // Handle disclaimer modal
        document.addEventListener('DOMContentLoaded', function() {
            const disclaimerModal = document.getElementById('disclaimerModal');
            const acceptBtn = document.getElementById('acceptDisclaimer');
            const mainApp = document.getElementById('mainApp');
            
            // Check if user has already accepted (stored in localStorage)
            if (localStorage.getItem('disclaimerAccepted') === 'true') {
                disclaimerModal.style.display = 'none';
                mainApp.style.display = 'block';
            }
            
            // Handle accept button click
            acceptBtn.addEventListener('click', function() {
                localStorage.setItem('disclaimerAccepted', 'true');
                disclaimerModal.style.display = 'none';
                mainApp.style.display = 'block';
            });
        });
    </script>
</body>

</html>
